From: =?UTF-8?q?Mika=20Pfl=C3=BCger?= <debian@mikapflueger.de>
Date: Sun, 4 Mar 2012 00:45:49 +0100
Subject: debian file locations for dcc policy

---
 policy/modules/services/dcc.fc |   12 +++++++++++-
 policy/modules/services/dcc.te |   18 ++++++++++++++++++
 2 files changed, 29 insertions(+), 1 deletions(-)

diff --git a/policy/modules/services/dcc.fc b/policy/modules/services/dcc.fc
index ecda170..cff5b16 100644
--- a/policy/modules/services/dcc.fc
+++ b/policy/modules/services/dcc.fc
@@ -5,16 +5,26 @@
 /usr/bin/cdcc			--	gen_context(system_u:object_r:cdcc_exec_t,s0)
 /usr/bin/dccproc		--	gen_context(system_u:object_r:dcc_client_exec_t,s0)
 
+ifdef(`distro_redhat',`
 /usr/libexec/dcc/dbclean	--	gen_context(system_u:object_r:dcc_dbclean_exec_t,s0)
 /usr/libexec/dcc/dccd		--	gen_context(system_u:object_r:dccd_exec_t,s0)
 /usr/libexec/dcc/dccifd		--	gen_context(system_u:object_r:dccifd_exec_t,s0)
 /usr/libexec/dcc/dccm		--	gen_context(system_u:object_r:dccm_exec_t,s0)
+')
+ifdef(`distro_debian',`
+/usr/sbin/dbclean               --	gen_context(system_u:object_r:dcc_dbclean_exec_t,s0)
+/usr/sbin/dccd		        --	gen_context(system_u:object_r:dccd_exec_t,s0)
+/usr/sbin/dccifd		--	gen_context(system_u:object_r:dccifd_exec_t,s0)
+/usr/sbin/dccm		        --	gen_context(system_u:object_r:dccm_exec_t,s0)
+')
 
+ifdef(`distro_redhat',`
 /var/dcc(/.*)?				gen_context(system_u:object_r:dcc_var_t,s0)
 /var/dcc/map			--	gen_context(system_u:object_r:dcc_client_map_t,s0)
-
+', `
 /var/lib/dcc(/.*)?			gen_context(system_u:object_r:dcc_var_t,s0)
 /var/lib/dcc/map		--	gen_context(system_u:object_r:dcc_client_map_t,s0)
+')
 
 /var/run/dcc(/.*)?			gen_context(system_u:object_r:dcc_var_run_t,s0)
 /var/run/dcc/map		--	gen_context(system_u:object_r:dcc_client_map_t,s0)
diff --git a/policy/modules/services/dcc.te b/policy/modules/services/dcc.te
index ec19ff4..4481433 100644
--- a/policy/modules/services/dcc.te
+++ b/policy/modules/services/dcc.te
@@ -91,6 +91,9 @@ files_tmp_filetrans(cdcc_t, cdcc_tmp_t, { file dir })
 allow cdcc_t dcc_client_map_t:file rw_file_perms;
 
 # Access files in /var/dcc. The map file can be updated
+ifdef(`distro_debian',`
+files_search_var_lib(cdcc_t)
+')
 allow cdcc_t dcc_var_t:dir list_dir_perms;
 read_files_pattern(cdcc_t, dcc_var_t, dcc_var_t)
 read_lnk_files_pattern(cdcc_t, dcc_var_t, dcc_var_t)
@@ -128,6 +131,9 @@ manage_files_pattern(dcc_client_t, dcc_client_tmp_t, dcc_client_tmp_t)
 files_tmp_filetrans(dcc_client_t, dcc_client_tmp_t, { file dir })
 
 # Access files in /var/dcc. The map file can be updated
+ifdef(`distro_debian',`
+files_search_var_lib(dcc_client_t)
+')
 allow dcc_client_t dcc_var_t:dir list_dir_perms;
 manage_files_pattern(dcc_client_t, dcc_var_t, dcc_var_t)
 read_lnk_files_pattern(dcc_client_t, dcc_var_t, dcc_var_t)
@@ -176,6 +182,9 @@ manage_dirs_pattern(dcc_dbclean_t, dcc_dbclean_tmp_t, dcc_dbclean_tmp_t)
 manage_files_pattern(dcc_dbclean_t, dcc_dbclean_tmp_t, dcc_dbclean_tmp_t)
 files_tmp_filetrans(dcc_dbclean_t, dcc_dbclean_tmp_t, { file dir })
 
+ifdef(`distro_debian',`
+files_search_var_lib(dcc_dbclean_t)
+')
 manage_dirs_pattern(dcc_dbclean_t, dcc_var_t, dcc_var_t)
 manage_files_pattern(dcc_dbclean_t, dcc_var_t, dcc_var_t)
 manage_lnk_files_pattern(dcc_dbclean_t, dcc_var_t, dcc_var_t)
@@ -214,6 +223,9 @@ allow dccd_t self:udp_socket create_socket_perms;
 allow dccd_t dcc_client_map_t:file rw_file_perms;
 
 # Access files in /var/dcc. The map file can be updated
+ifdef(`distro_debian',`
+files_search_var_lib(dccd_t)
+')
 allow dccd_t dcc_var_t:dir list_dir_perms;
 read_files_pattern(dccd_t, dcc_var_t, dcc_var_t)
 read_lnk_files_pattern(dccd_t, dcc_var_t, dcc_var_t)
@@ -288,6 +300,9 @@ allow dccifd_t self:udp_socket create_socket_perms;
 allow dccifd_t dcc_client_map_t:file rw_file_perms;
 
 # Updating dcc_db, flod, ...
+ifdef(`distro_debian',`
+files_search_var_lib(dccifd_t)
+')
 manage_dirs_pattern(dccifd_t, dcc_var_t, dcc_var_t)
 manage_files_pattern(dccifd_t, dcc_var_t, dcc_var_t)
 manage_lnk_files_pattern(dccifd_t, dcc_var_t, dcc_var_t)
@@ -352,6 +367,9 @@ allow dccm_t self:udp_socket create_socket_perms;
 
 allow dccm_t dcc_client_map_t:file rw_file_perms;
 
+ifdef(`distro_debian',`
+files_search_var_lib(dccm_t)
+')
 manage_dirs_pattern(dccm_t, dcc_var_t, dcc_var_t)
 manage_files_pattern(dccm_t, dcc_var_t, dcc_var_t)
 manage_lnk_files_pattern(dccm_t, dcc_var_t, dcc_var_t)
