From: =?UTF-8?q?Mika=20Pfl=C3=BCger?= <debian@mikapflueger.de>
Date: Sun, 4 Mar 2012 02:36:39 +0100
Subject: lvm policy adjustments: * Allow lvm_t rw access to unconfined_t
 semaphores * Allow lvm_t to use ptys

---
 policy/modules/system/lvm.te        |    6 ++++++
 policy/modules/system/unconfined.if |   18 ++++++++++++++++++
 2 files changed, 24 insertions(+), 0 deletions(-)

Index: refpolicy-2.20110726/policy/modules/system/lvm.te
===================================================================
--- refpolicy-2.20110726.orig/policy/modules/system/lvm.te	2012-06-21 23:37:32.619982514 +1000
+++ refpolicy-2.20110726/policy/modules/system/lvm.te	2012-06-21 23:37:36.108022660 +1000
@@ -41,6 +41,11 @@
 type lvm_tmp_t;
 files_tmp_file(lvm_tmp_t)
 
+allow lvm_t self:sem create_sem_perms;
+optional_policy(`
+	unconfined_sem_rw(lvm_t)
+')
+
 ########################################
 #
 # Cluster LVM daemon local policy
@@ -178,6 +183,7 @@
 
 allow lvm_t self:unix_stream_socket { connectto create_stream_socket_perms };
 allow lvm_t clvmd_t:unix_stream_socket { connectto rw_socket_perms };
+term_dontaudit_use_generic_ptys(lvm_t)
 
 manage_dirs_pattern(lvm_t, lvm_tmp_t, lvm_tmp_t)
 manage_files_pattern(lvm_t, lvm_tmp_t, lvm_tmp_t)
Index: refpolicy-2.20110726/policy/modules/system/unconfined.if
===================================================================
--- refpolicy-2.20110726.orig/policy/modules/system/unconfined.if	2012-06-21 23:37:32.619982514 +1000
+++ refpolicy-2.20110726/policy/modules/system/unconfined.if	2012-06-21 23:37:36.108022660 +1000
@@ -320,6 +320,24 @@
 
 ########################################
 ## <summary>
+##	rw access to a semaphore created by the unconfined domain.
+## </summary>
+## <param name="domain">
+##	<summary>
+##	Domain allowed access.
+##	</summary>
+## </param>
+#
+interface(`unconfined_sem_rw',`
+	gen_require(`
+		type unconfined_t;
+	')
+
+	allow $1 unconfined_t:sem rw_sem_perms;
+')
+
+########################################
+## <summary>
 ##	Send a SIGCHLD signal to the unconfined domain.
 ## </summary>
 ## <param name="domain">
