From: =?UTF-8?q?Mika=20Pfl=C3=BCger?= <debian@mikapflueger.de>
Date: Fri, 2 Mar 2012 03:56:30 +0100
Subject: Allow several programs to read from the console

---
 policy/modules/services/portmap.te   |    2 ++
 policy/modules/system/modutils.te    |    1 +
 policy/modules/system/selinuxutil.te |    1 +
 policy/modules/system/sysnetwork.te  |    1 +
 4 files changed, 5 insertions(+), 0 deletions(-)

diff --git a/policy/modules/services/portmap.te b/policy/modules/services/portmap.te
index e7fbfd9..30e2fed 100644
--- a/policy/modules/services/portmap.te
+++ b/policy/modules/services/portmap.te
@@ -33,6 +33,7 @@ allow portmap_t self:unix_stream_socket create_stream_socket_perms;
 allow portmap_t self:tcp_socket create_stream_socket_perms;
 allow portmap_t self:udp_socket create_socket_perms;
 dev_read_urand(portmap_t)
+term_read_console(portmap_t)
 
 manage_dirs_pattern(portmap_t, portmap_tmp_t, portmap_tmp_t)
 manage_files_pattern(portmap_t, portmap_tmp_t, portmap_tmp_t)
@@ -114,6 +115,7 @@ allow portmap_helper_t self:udp_socket create_socket_perms;
 allow portmap_helper_t portmap_var_run_t:file manage_file_perms;
 files_pid_filetrans(portmap_helper_t, portmap_var_run_t, file)
 dev_read_urand(portmap_helper_t)
+term_read_console(portmap_helper_t)
 
 corenet_all_recvfrom_unlabeled(portmap_helper_t)
 corenet_all_recvfrom_netlabel(portmap_helper_t)
diff --git a/policy/modules/system/modutils.te b/policy/modules/system/modutils.te
index da014ed..6102997 100644
--- a/policy/modules/system/modutils.te
+++ b/policy/modules/system/modutils.te
@@ -109,6 +109,7 @@ allow insmod_t self:process { execmem sigchld sigkill sigstop signull signal };
 
 allow insmod_t self:udp_socket create_socket_perms;
 allow insmod_t self:rawip_socket create_socket_perms;
+term_read_console(insmod_t)
 
 # Read module config and dependency information
 list_dirs_pattern(insmod_t, modules_conf_t, modules_conf_t)
diff --git a/policy/modules/system/selinuxutil.te b/policy/modules/system/selinuxutil.te
index acdcf0b..e9e4f30 100644
--- a/policy/modules/system/selinuxutil.te
+++ b/policy/modules/system/selinuxutil.te
@@ -107,6 +107,7 @@ type setfiles_t alias restorecon_t, can_relabelto_binary_policy;
 type setfiles_exec_t alias restorecon_exec_t;
 init_system_domain(setfiles_t, setfiles_exec_t)
 domain_obj_id_change_exemption(setfiles_t)
+term_read_console(setfiles_t)
 dev_read_urand(setfiles_t)
 
 ########################################
diff --git a/policy/modules/system/sysnetwork.te b/policy/modules/system/sysnetwork.te
index d716d35..49e6c5e 100644
--- a/policy/modules/system/sysnetwork.te
+++ b/policy/modules/system/sysnetwork.te
@@ -253,6 +253,7 @@ allow ifconfig_t self:shm create_shm_perms;
 allow ifconfig_t self:sem create_sem_perms;
 allow ifconfig_t self:msgq create_msgq_perms;
 allow ifconfig_t self:msg { send receive };
+term_read_console(ifconfig_t)
 # Create UDP sockets, necessary when called from dhcpc
 allow ifconfig_t self:udp_socket create_socket_perms;
 # for /sbin/ip
